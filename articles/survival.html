<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integration with CyTOF - Survival Analaysis â€¢ BIRSBIO2020.scProteomics.survival</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Integration with CyTOF - Survival Analaysis">
<meta property="og:description" content="BIRSBIO2020.scProteomics.survival">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BIRSBIO2020.scProteomics.survival</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/preliminary.html">Preliminary Analysis</a>
    </li>
    <li>
      <a href="../articles/spatialFeatures.html">Spatial Features</a>
    </li>
    <li>
      <a href="../articles/survival.html">Integration with CyTOF - Survival Analaysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/yingxinlin/BIRSBIO2020.scProteomics.survival">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="survival_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Integration with CyTOF - Survival Analaysis</h1>
                        <h4 class="author">Yingxin Lin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yingxinlin/BIRSBIO2020.scProteomics.survival/blob/master/vignettes/survival.Rmd"><code>vignettes/survival.Rmd</code></a></small>
      <div class="hidden name"><code>survival.Rmd</code></div>

    </div>

    
    
<div id="data-and-package" class="section level1">
<h1 class="hasAnchor">
<a href="#data-and-package" class="anchor"></a>Data and package</h1>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">SingleCellExperiment</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scater</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">plyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pheatmap</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggthemes</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RColorBrewer</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spatstat</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gridExtra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggpubr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spatstat</span>)
<span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="st">"../R/image_analysis_functions.R"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">mibi.sce</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="st">"data/mibi.sce_withDR.rds"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">mibi.sce</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">mibi.sce</span>$<span class="no">SampleID</span>, <span class="no">mibi.sce</span>$<span class="no">cellLabelInImage</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"_"</span>)

<span class="no">mibi.sce</span>$<span class="no">cellTypes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="no">mibi.sce</span>$<span class="no">immune_group</span>) <span class="kw">!=</span> <span class="st">"not immune"</span>,
                             <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="no">mibi.sce</span>$<span class="no">immune_group</span>),
                             <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="no">mibi.sce</span>$<span class="no">tumor_group</span>))

<span class="no">mibi.sce</span>$<span class="no">cellTypes_group</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="no">mibi.sce</span>$<span class="no">immune_group</span>) <span class="kw">!=</span> <span class="st">"not immune"</span>,
                                   <span class="st">"Micro-environment"</span>,
                                   <span class="st">"Tumour"</span>)



<span class="no">selected_chanel_mibi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">mibi.sce</span>)[<span class="fu">rowData</span>(<span class="no">mibi.sce</span>)$<span class="no">is_protein</span> <span class="kw">==</span> <span class="fl">1</span>]</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># color for mibi cell types</span>
<span class="no">cellTypes_group_mibi_color</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/tableau_color_pal.html">tableau_color_pal</a></span>(<span class="st">"Tableau 10"</span>)(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="no">mibi.sce</span>$<span class="no">cellTypes_group</span>)))
<span class="no">cellTypes_group_mibi_color</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cellTypes_group_mibi_color</span>, <span class="st">"black"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span>(<span class="no">cellTypes_group_mibi_color</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="no">mibi.sce</span>$<span class="no">cellTypes_group</span>), <span class="st">"Background"</span>)

<span class="no">cellTypes_mibi_color</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/tableau_color_pal.html">tableau_color_pal</a></span>(<span class="st">"Classic 20"</span>)(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="no">mibi.sce</span>$<span class="no">cellTypes</span>)))
<span class="no">cellTypes_mibi_color</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cellTypes_mibi_color</span>, <span class="st">"black"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span>(<span class="no">cellTypes_mibi_color</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="no">mibi.sce</span>$<span class="no">cellTypes</span>), <span class="st">"Background"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">tiff_name_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="st">"../../sc-targeted-proteomics/data/TNBC_shareCellData/"</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">".tiff"</span>)
<span class="no">tiff_name_list</span> <span class="kw">&lt;-</span> <span class="no">tiff_name_list</span>[-<span class="fl">24</span>]

<span class="no">common_protein</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CD3"</span>, <span class="st">"CD68"</span>, <span class="st">"HLA-DR"</span>, <span class="st">"CD45"</span>)

<span class="no">ot_rbind_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">s</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">tiff_name_list</span>)) {


  <span class="no">str_name</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"../../sc-targeted-proteomics/data/TNBC_shareCellData/"</span>, <span class="no">tiff_name_list</span>[<span class="no">s</span>], <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)

  <span class="no">sample_id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"p"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"_labeledcellData.tiff"</span>, <span class="st">""</span>, <span class="no">tiff_name_list</span>[<span class="no">s</span>])))

  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">sample_id</span>)

  <span class="no">p_sce</span> <span class="kw">&lt;-</span> <span class="no">mibi.sce</span>[, <span class="no">mibi.sce</span>$<span class="no">SampleID</span> <span class="kw">==</span> <span class="no">sample_id</span>]
  <span class="no">p_sce</span> <span class="kw">&lt;-</span> <span class="no">p_sce</span>[<span class="fu">rowData</span>(<span class="no">p_sce</span>)$<span class="no">is_protein</span> <span class="kw">==</span> <span class="fl">1</span>, ]
  <span class="no">exprsMat</span> <span class="kw">&lt;-</span> <span class="fu">assay</span>(<span class="no">p_sce</span>, <span class="st">"mibi_exprs"</span>)


  <span class="co"># Optimal transport results</span>

  <span class="no">epith_ot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"../../sc-targeted-proteomics/OT/data/mibi_exprs_ot_pred_mat_epith/pred_res_mat_all_patient_"</span>, <span class="no">sample_id</span>, <span class="st">".csv"</span>), <span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">1</span>)

  <span class="no">epith_ot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span>(<span class="no">epith_ot</span>)



  <span class="no">tcells_ot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"../../sc-targeted-proteomics/OT/data/mibi_exprs_ot_pred_mat_tcells/pred_res_mat_all_patient_"</span>, <span class="no">sample_id</span>, <span class="st">".csv"</span>), <span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">1</span>)

  <span class="no">tcells_ot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span>(<span class="no">tcells_ot</span>)




  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">epith_ot</span>)[<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">epith_ot</span>) <span class="kw">==</span> <span class="st">"HLADR"</span>] <span class="kw">&lt;-</span> <span class="st">"HLA-DR"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">tcells_ot</span>)[<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">tcells_ot</span>) <span class="kw">==</span> <span class="st">"HLADR"</span>] <span class="kw">&lt;-</span> <span class="st">"HLA-DR"</span>




  <span class="no">ot_rbind</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>((<span class="no">epith_ot</span>),
                    (<span class="no">tcells_ot</span>[!<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">tcells_ot</span>) <span class="kw">%in%</span> <span class="no">common_protein</span>,]))

  <span class="no">ot_rbind</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">ot_rbind</span>, <span class="fl">1</span>, <span class="no">scale</span>))

  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">ot_rbind</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">exprsMat</span>)
  <span class="no">ot_rbind_list</span><span class="kw">[[</span><span class="no">s</span>]] <span class="kw">&lt;-</span> <span class="no">ot_rbind</span>


}

<span class="no">ot_rbind_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">cbind</span>, <span class="no">ot_rbind_list</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">ot_rbind_list</span>, <span class="st">"data/mibi_ot_all.rds"</span>)</pre></body></html></div>
</div>
<div id="clustering-on-imputed-matrix" class="section level1">
<h1 class="hasAnchor">
<a href="#clustering-on-imputed-matrix" class="anchor"></a>Clustering on imputed matrix</h1>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">"data/ot_rbind_list.rda"</span>)

<span class="no">mibi.sce_filtered</span> <span class="kw">&lt;-</span> <span class="no">mibi.sce</span>[, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">ot_rbind_list</span>)]

<span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/altExps.html">altExp</a></span>(<span class="no">mibi.sce_filtered</span>, <span class="st">"OT"</span>) <span class="kw">&lt;-</span> <span class="fu">SummarizedExperiment</span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">exprs</span> <span class="kw">=</span> <span class="no">ot_rbind_list</span>))




<span class="no">mibi.sce_filtered</span> <span class="kw">&lt;-</span> <span class="kw pkg">scater</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span>(<span class="no">mibi.sce_filtered</span>,
                                    <span class="kw">altexp</span> <span class="kw">=</span> <span class="st">"OT"</span>,
                                    <span class="kw">ncomponents</span> <span class="kw">=</span> <span class="fl">20</span>,
                                    <span class="kw">exprs_values</span> <span class="kw">=</span> <span class="st">"exprs"</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">"OT_PCA"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2020</span>)
<span class="no">mibi.sce_filtered</span> <span class="kw">&lt;-</span> <span class="kw pkg">scater</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html">runUMAP</a></span>(<span class="no">mibi.sce_filtered</span>,
                                     <span class="kw">altexp</span> <span class="kw">=</span> <span class="st">"OT"</span>,
                                     <span class="kw">exprs_values</span> <span class="kw">=</span> <span class="st">"exprs"</span>,
                                     <span class="kw">pca</span> <span class="kw">=</span> <span class="fl">20</span>,
                                     <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                     <span class="kw">n_neighbors</span> <span class="kw">=</span> <span class="fl">20</span>,
                                     <span class="kw">name</span> <span class="kw">=</span> <span class="st">"OT_UMAP"</span>)


<span class="co"># g &lt;- scran::buildKNNGraph(mibi.sce_filtered, k = 50, use.dimred = "OT_PCA")</span>
<span class="co"># clust &lt;- igraph::cluster_louvain(g)$membership</span>
<span class="co"># table(clust)</span>

<span class="no">g</span> <span class="kw">&lt;-</span> <span class="kw pkg">scran</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/buildSNNGraph.html">buildKNNGraph</a></span>(<span class="no">mibi.sce_filtered</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">50</span>, <span class="kw">use.dimred</span> <span class="kw">=</span> <span class="st">"OT_PCA"</span>)
<span class="no">clust</span> <span class="kw">&lt;-</span> <span class="kw pkg">igraph</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cluster_louvain.html">cluster_louvain</a></span>(<span class="no">g</span>)$<span class="no">membership</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">clust</span>)</pre></body></html></div>
<pre><code>## clust
##     1     2     3     4     5     6     7     8     9    10    11    12    13 
##  4110 12520 16729 18822  1002 11641 11937  8758  1874  1541  3846 11122  1967 
##    14    15    16    17    18    19    20    21    22    23    24    25 
##  9738 13221  1327 13087   422 22752  6523  8367  3470  8181   722  3999</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">mibi.sce_filtered</span>$<span class="no">ot_cluster</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">as.factor</a></span>(<span class="no">clust</span>)</pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">df_toPlot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu">colData</span>(<span class="no">mibi.sce_filtered</span>))

<span class="no">cellTypes_color_cluster</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw pkg">RColorBrewer</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">12</span>, <span class="st">"Paired"</span>),
                             <span class="kw pkg">RColorBrewer</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">7</span>, <span class="st">"Dark2"</span>),
                             <span class="kw pkg">RColorBrewer</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">8</span>, <span class="st">"Pastel2"</span>),
                             <span class="kw pkg">RColorBrewer</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">12</span>, <span class="st">"Set3"</span>),
                             <span class="kw pkg">RColorBrewer</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">8</span>, <span class="st">"Set2"</span>))

<span class="no">umap_mibi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html">reducedDim</a></span>(<span class="no">mibi.sce_filtered</span>, <span class="st">"OT_UMAP"</span>)

<span class="no">df_toPlot</span>$<span class="no">UMAP1_ot</span> <span class="kw">&lt;-</span> <span class="no">umap_mibi</span>[, <span class="fl">1</span>]
<span class="no">df_toPlot</span>$<span class="no">UMAP2_ot</span> <span class="kw">&lt;-</span> <span class="no">umap_mibi</span>[, <span class="fl">2</span>]

<span class="no">umap</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html">reducedDim</a></span>(<span class="no">mibi.sce_filtered</span>, <span class="st">"UMAP"</span>)

<span class="no">df_toPlot</span>$<span class="no">UMAP1</span> <span class="kw">&lt;-</span> <span class="no">umap</span>[, <span class="fl">1</span>]
<span class="no">df_toPlot</span>$<span class="no">UMAP2</span> <span class="kw">&lt;-</span> <span class="no">umap</span>[, <span class="fl">2</span>]

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scattermore</span>)
<span class="no">g1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">ot_cluster</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">cellTypes_color_cluster</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Cell Type"</span>)


<span class="no">g2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">cellTypes</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">cellTypes_mibi_color</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Cell Type"</span>)


<span class="no">g3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">SampleID</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">cellTypes_color_cluster</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Cell Type"</span>)



<span class="no">g4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1_ot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2_ot</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">ot_cluster</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">cellTypes_color_cluster</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Cell Type"</span>)

<span class="no">g5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1_ot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2_ot</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">cellTypes</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">cellTypes_mibi_color</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Cell Type"</span>)

<span class="no">g6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1_ot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2_ot</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">SampleID</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">cellTypes_color_cluster</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Cell Type"</span>)


<span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/ggarrange.html">ggarrange</a></span>(<span class="no">g1</span>, <span class="no">g4</span>,
          <span class="no">g2</span>, <span class="no">g5</span>,
          <span class="no">g3</span>, <span class="no">g6</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">align</span> <span class="kw">=</span> <span class="st">"hv"</span>)</pre></body></html></div>
<p><img src="survival_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">exprsMat</span> <span class="kw">&lt;-</span> <span class="fu">assay</span>(<span class="no">mibi.sce_filtered</span>, <span class="st">"mibi_exprs"</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">ot_cluster</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">exprsMat</span>[<span class="st">"Ki67"</span>, ], <span class="kw">fill</span> <span class="kw">=</span> <span class="no">ot_cluster</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">cellTypes_color_cluster</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"OT Cell Type"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Ki67"</span>)</pre></body></html></div>
<p><img src="survival_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">g2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1_ot</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2_ot</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">exprsMat</span>[<span class="st">"Ki67"</span>, ] + <span class="fl">1</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Ki67"</span>)

<span class="no">g1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_toPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">exprsMat</span>[<span class="st">"Ki67"</span>, ] + <span class="fl">1</span>))) +
  <span class="fu"><a href="https://rdrr.io/pkg/scattermore/man/geom_scattermore.html">geom_scattermore</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Ki67"</span>)

<span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/ggarrange.html">ggarrange</a></span>(<span class="no">g1</span>, <span class="no">g2</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">align</span> <span class="kw">=</span> <span class="st">"hv"</span>)</pre></body></html></div>
<p><img src="survival_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div id="survival-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#survival-analysis" class="anchor"></a>Survival Analysis</h1>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">survival</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">survminer</span>)</pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">cold</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>, <span class="fl">26</span>, <span class="fl">15</span>, <span class="fl">22</span>, <span class="fl">19</span>, <span class="fl">25</span>)
<span class="no">mixed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">13</span>, <span class="fl">39</span>, <span class="fl">29</span>, <span class="fl">17</span>, <span class="fl">23</span>, <span class="fl">1</span>, <span class="fl">33</span>, <span class="fl">12</span>, <span class="fl">27</span>, <span class="fl">8</span>, <span class="fl">2</span>, <span class="fl">38</span>, <span class="fl">20</span>, <span class="fl">7</span>, <span class="fl">14</span>, <span class="fl">11</span>, <span class="fl">21</span>, <span class="fl">31</span>, <span class="fl">18</span>)
<span class="no">compart</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">35</span>, <span class="fl">28</span>, <span class="fl">16</span>, <span class="fl">37</span>, <span class="fl">40</span>, <span class="fl">4</span>, <span class="fl">41</span>, <span class="fl">36</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">34</span>, <span class="fl">32</span>, <span class="fl">6</span>, <span class="fl">9</span>, <span class="fl">10</span>)


<span class="no">mibi.sce_filtered</span>$<span class="no">patientGroup</span> <span class="kw">&lt;-</span> <span class="fl">NA</span>
<span class="no">mibi.sce_filtered</span>$<span class="no">patientGroup</span>[<span class="no">mibi.sce_filtered</span>$<span class="no">SampleID</span> <span class="kw">%in%</span> <span class="no">mixed</span>] <span class="kw">&lt;-</span> <span class="st">"mixed"</span>
<span class="no">mibi.sce_filtered</span>$<span class="no">patientGroup</span>[<span class="no">mibi.sce_filtered</span>$<span class="no">SampleID</span> <span class="kw">%in%</span> <span class="no">compart</span>] <span class="kw">&lt;-</span> <span class="st">"compartmentalized"</span>
<span class="no">mibi.sce_filtered</span>$<span class="no">patientGroup</span>[<span class="no">mibi.sce_filtered</span>$<span class="no">SampleID</span> <span class="kw">%in%</span> <span class="no">cold</span>] <span class="kw">&lt;-</span> <span class="st">"cold"</span>

<span class="no">meta_patients</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu">colData</span>(<span class="no">mibi.sce_filtered</span>)[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SampleID"</span>, <span class="st">"patientGroup"</span>, <span class="st">"Survival_days_capped_2016.1.1"</span>, <span class="st">"Censored"</span>, <span class="st">"GRADE"</span>, <span class="st">"STAGE"</span>, <span class="st">"AGE_AT_DX"</span>, <span class="st">"TIL_score"</span>)]))
<span class="no">meta_patients</span>$<span class="no">STAGE</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="no">meta_patients</span>$<span class="no">STAGE</span>), <span class="fl">1</span>, <span class="fl">1</span>)
<span class="no">meta_patients</span>$<span class="no">STAGE</span>[<span class="no">meta_patients</span>$<span class="no">STAGE</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">4</span>)] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"3_4"</span>)
<span class="no">meta_patients</span>$<span class="no">Censoring</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - <span class="no">meta_patients</span>$<span class="no">Censored</span>

<span class="no">meta_patients</span> <span class="kw">&lt;-</span> <span class="no">meta_patients</span>[!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">meta_patients</span>$<span class="no">Survival_days_capped_2016.1.1</span>), ]
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span>(<span class="no">meta_patients</span>)</pre></body></html></div>
<pre><code>## [1] 38  9</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">meta_patients</span>)[<span class="fl">3</span>] <span class="kw">&lt;-</span> <span class="st">"SurvivalDays"</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span>(<span class="no">meta_patients</span>)</pre></body></html></div>
<pre><code>## [1] 38  9</code></pre>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">fit_stage</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>( <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">SurvivalDays</span>, <span class="no">Censoring</span>) ~ <span class="no">STAGE</span>,
                 <span class="kw">data</span> <span class="kw">=</span> <span class="no">meta_patients</span>)



<span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span>(<span class="no">fit_stage</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">meta_patients</span>,
           <span class="co"># conf.int = TRUE,</span>
           <span class="kw">risk.table</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">risk.table.col</span><span class="kw">=</span><span class="st">"strata"</span>,
           <span class="kw">ggtheme</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>(),
           <span class="kw">pval</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="survival_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">fit_patientGroup</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>( <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">SurvivalDays</span>, <span class="no">Censoring</span>) ~ <span class="no">patientGroup</span>,
                      <span class="kw">data</span> <span class="kw">=</span> <span class="no">meta_patients</span>)



<span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span>(<span class="no">fit_patientGroup</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">meta_patients</span>,
           <span class="co"># conf.int = TRUE,</span>
           <span class="kw">risk.table</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">risk.table.col</span> <span class="kw">=</span> <span class="st">"strata"</span>,
           <span class="kw">ggtheme</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>(),
           <span class="kw">pval</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="survival_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">prop_ot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">mibi.sce_filtered</span>$<span class="no">ot_cluster</span>, <span class="no">mibi.sce_filtered</span>$<span class="no">SampleID</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">prop_ot</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ot_cluster_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">prop_ot</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)

<span class="no">prop_ot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">prop_ot</span>, <span class="fl">2</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>))

<span class="no">meta_patients</span>$<span class="no">ki67_class</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">prop_ot</span>[<span class="fl">15</span>, ][<span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span>(<span class="no">meta_patients</span>$<span class="no">SampleID</span>)] <span class="kw">&gt;</span> <span class="fl">0.06</span>,
                                         <span class="st">"High"</span>, <span class="st">"Low"</span>)
<span class="no">meta_patients</span>$<span class="no">ki67_class</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">meta_patients</span>$<span class="no">ki67_class</span>,
                                         <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Low"</span>, <span class="st">"High"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">meta_patients</span>$<span class="no">ki67_class</span>)</pre></body></html></div>
<pre><code>## 
##  Low High 
##   23   15</code></pre>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">fit_ki67</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>( <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(<span class="no">SurvivalDays</span>, <span class="no">Censoring</span>) ~ <span class="no">ki67_class</span> + <span class="no">STAGE</span>,
                 <span class="kw">data</span> <span class="kw">=</span> <span class="no">meta_patients</span> )

<span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span>(<span class="no">fit_ki67</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">meta_patients</span>,
           <span class="kw">ggtheme</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">0.8</span>),
           <span class="kw">palette</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/tableau_color_pal.html">tableau_color_pal</a></span>(<span class="st">"Tableau 20"</span>)(<span class="fl">6</span>)[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>)],
           <span class="kw">pval</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="survival_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div id="session-information" class="section level1">
<h1 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session Information</h1>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</pre></body></html></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-openmp/libopenblasp-r0.3.8.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] survminer_0.4.8             survival_3.2-3             
##  [3] scattermore_0.6             ggpubr_0.4.0               
##  [5] gridExtra_2.3               spatstat_1.64-1            
##  [7] rpart_4.1-15                nlme_3.1-148               
##  [9] spatstat.data_1.4-3         RColorBrewer_1.1-2         
## [11] ggthemes_4.2.0              pheatmap_1.0.12            
## [13] plyr_1.8.6                  scater_1.17.4              
## [15] ggplot2_3.3.2               SingleCellExperiment_1.11.6
## [17] SummarizedExperiment_1.19.6 DelayedArray_0.15.7        
## [19] matrixStats_0.56.0          Matrix_1.2-18              
## [21] Biobase_2.49.0              GenomicRanges_1.41.5       
## [23] GenomeInfoDb_1.25.8         IRanges_2.23.10            
## [25] S4Vectors_0.27.12           BiocGenerics_0.35.4        
## [27] raster_3.3-13               sp_1.4-2                   
## 
## loaded via a namespace (and not attached):
##   [1] ggbeeswarm_0.6.0          colorspace_1.4-1         
##   [3] ggsignif_0.6.0            deldir_0.1-28            
##   [5] ellipsis_0.3.1            rio_0.5.16               
##   [7] rprojroot_1.3-2           scuttle_0.99.11          
##   [9] bluster_0.99.1            XVector_0.29.3           
##  [11] BiocNeighbors_1.7.0       fs_1.5.0                 
##  [13] farver_2.0.3              RSpectra_0.16-0          
##  [15] codetools_0.2-16          splines_4.0.2            
##  [17] knitr_1.29                polyclip_1.10-0          
##  [19] km.ci_0.5-2               broom_0.7.0              
##  [21] uwot_0.1.8                compiler_4.0.2           
##  [23] dqrng_0.2.1               backports_1.1.8          
##  [25] assertthat_0.2.1          limma_3.45.9             
##  [27] BiocSingular_1.5.0        htmltools_0.5.0          
##  [29] tools_4.0.2               igraph_1.2.5             
##  [31] rsvd_1.0.3                gtable_0.3.0             
##  [33] glue_1.4.1                GenomeInfoDbData_1.2.3   
##  [35] dplyr_1.0.1               Rcpp_1.0.5               
##  [37] carData_3.0-4             cellranger_1.1.0         
##  [39] pkgdown_1.5.1             vctrs_0.3.2              
##  [41] DelayedMatrixStats_1.11.1 xfun_0.16                
##  [43] stringr_1.4.0             openxlsx_4.1.5           
##  [45] lifecycle_0.2.0           irlba_2.3.3              
##  [47] statmod_1.4.34            rstatix_0.6.0            
##  [49] goftest_1.2-2             edgeR_3.31.4             
##  [51] zoo_1.8-8                 zlibbioc_1.35.0          
##  [53] MASS_7.3-51.6             scales_1.1.1             
##  [55] hms_0.5.3                 spatstat.utils_1.17-0    
##  [57] yaml_2.2.1                curl_4.3                 
##  [59] memoise_1.1.0             KMsurv_0.1-5             
##  [61] stringi_1.4.6             desc_1.2.0               
##  [63] scran_1.17.14             zip_2.0.4                
##  [65] BiocParallel_1.23.2       rlang_0.4.7              
##  [67] pkgconfig_2.0.3           bitops_1.0-6             
##  [69] evaluate_0.14             lattice_0.20-41          
##  [71] purrr_0.3.4               tensor_1.5               
##  [73] labeling_0.3              cowplot_1.0.0            
##  [75] tidyselect_1.1.0          RcppAnnoy_0.0.16         
##  [77] magrittr_1.5              R6_2.4.1                 
##  [79] generics_0.0.2            pillar_1.4.6             
##  [81] haven_2.3.1               foreign_0.8-80           
##  [83] withr_2.2.0               mgcv_1.8-31              
##  [85] abind_1.4-5               RCurl_1.98-1.2           
##  [87] tibble_3.0.3              crayon_1.3.4             
##  [89] car_3.0-8                 survMisc_0.5.5           
##  [91] rmarkdown_2.3             viridis_0.5.1            
##  [93] locfit_1.5-9.4            grid_4.0.2               
##  [95] readxl_1.3.1              data.table_1.13.0        
##  [97] forcats_0.5.0             digest_0.6.25            
##  [99] xtable_1.8-4              tidyr_1.1.1              
## [101] munsell_0.5.0             beeswarm_0.2.3           
## [103] viridisLite_0.3.0         vipor_0.4.5</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Yingxin Lin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
